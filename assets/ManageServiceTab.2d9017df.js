import{_ as C,o as u,e as b,w as e,b as t,d as i,t as o,c as x,f as B,F as k,r as _,h as E,E as p,i as V,l as D,a as S,g as K,j as q,v as L}from"./index.8a6550d5.js";import{S as F}from"./ServiceEditor.86815883.js";const I={name:"ServiceViewer",props:{service:Object},data(){return{size:"large"}},mounted:function(){}};function N(n,r,a,v,s,f){const l=_("el-descriptions-item"),c=_("el-tag"),h=_("el-descriptions");return u(),b(h,{title:a.service.name+"-"+a.service.type+"-"+a.service.version,direction:"vertical",column:6,size:s.size,border:""},{default:e(()=>[t(l,{label:"\u670D\u52A1\u540D\u79F0",span:2},{default:e(()=>[i(o(a.service.name),1)]),_:1}),t(l,{label:"\u670D\u52A1\u67B6\u6784",span:2},{default:e(()=>[i(o(a.service.type),1)]),_:1}),t(l,{label:"\u670D\u52A1\u7248\u672C",span:2},{default:e(()=>[i(o(a.service.version),1)]),_:1}),t(l,{label:"\u5F00\u53D1\u5546",span:2},{default:e(()=>[i(o(a.service.author),1)]),_:1}),t(l,{label:"\u53EF\u7528\u72B6\u6001",span:1},{default:e(()=>[a.service.enable?(u(),b(c,{key:0,size:"small"},{default:e(()=>[i("\u53EF\u7528")]),_:1})):(u(),b(c,{key:1,size:"small",type:"danger"},{default:e(()=>[i("\u4E0D\u53EF\u7528")]),_:1}))]),_:1}),t(l,{label:"\u81EA\u542F\u52A8",span:1},{default:e(()=>[a.service.autostart?(u(),b(c,{key:0,size:"small"},{default:e(()=>[i("\u662F")]),_:1})):(u(),b(c,{key:1,size:"small",type:"danger"},{default:e(()=>[i("\u5426")]),_:1}))]),_:1}),t(l,{label:"\u7EC4\u4EF6\u5165\u53E3",span:2},{default:e(()=>[i(o(a.service.service),1)]),_:1}),t(l,{label:"\u7EC4\u4EF6\u63CF\u8FF0",span:6},{default:e(()=>[i(o(a.service.summary),1)]),_:1}),t(l,{label:"\u7EC4\u4EF6\u4E3B\u9875",span:6},{default:e(()=>[i(o(a.service.homepage),1)]),_:1}),t(l,{label:"\u7EC4\u4EF6\u955C\u50CF\u5730\u5740",span:6},{default:e(()=>[i(o(a.service.location),1)]),_:1}),t(l,{label:"\u6B64\u7EC4\u4EF6\u4F9D\u8D56\u7684\u670D\u52A1",span:6},{default:e(()=>[(u(!0),x(k,null,B(a.service.requires,(m,w)=>(u(),x(k,{key:m},[m.enable?(u(),b(c,{key:0,size:"large",class:"mx-1 myTag"},{default:e(()=>[i(o(m.name),1)]),_:2},1024)):(u(),b(c,{key:1,size:"large",class:"mx-1 myTag",type:"danger"},{default:e(()=>[i(o(m.name)+" [\u7F3A\u5931\u6216\u4E0D\u53EF\u7528]",1)]),_:2},1024))],64))),128))]),_:1})]),_:1},8,["title","size"])}const j=C(I,[["render",N]]);let T,d,A=!1,O=!1;const P={name:"ManageServiceTab",setup(){T=K(),d=T.appContext.config.globalProperties.$smkManager},mounted:function(){this.covertSMKList()},data(){return{parentBorder:A,childBorder:O,tableData:void 0,dialogVisible:!1,bt1Text:"\u4FEE\u6539",bt2Text:"\u53D6\u6D88",bt2Show:!1,selectedService:void 0}},components:{ElTable:E,ServiceViewer:j,ServiceEditor:F,ElMessage:p,ElMessageBox:V},watch:{dialogVisible:function(n){n||this.covertSMKList()}},methods:{bt1Click:function(){this.bt1Text=="\u4FEE\u6539"?(this.bt2Show=!0,this.bt2Text="\u53D6\u6D88",this.bt1Text="\u63D0\u4EA4\u4FEE\u6539"):this.$refs.ed.check(n=>{if(!n){p.error("\u6570\u636E\u586B\u5199\u6709\u8BEF\uFF0C\u8BF7\u68C0\u67E5");return}let r=this.$refs.ed.getServiceInfo();d.updateService(d.getService(this.selectedService),r)?(p({message:"SMK\u670D\u52A1\u66F4\u65B0\u6210\u529F",type:"success"}),this.clear()):p.error("SMK\u670D\u52A1\u66F4\u65B0\u5931\u8D25")})},bt2Click:function(){this.bt2Text=="\u53D6\u6D88"&&(this.bt2Show=!1,this.bt1Text="\u4FEE\u6539")},showDialog(n){this.dialogVisible=!0,n!=null?setTimeout(()=>{this.$refs.ed.resetFields(),this.selectedService=d.generateServiceVersionTag(n),this.$refs.ed.setServiceInfo(n)},1e3):this.dialogVisible=!1},handleEdit:function(n,r){this.showDialog(d.getService(d.generateServiceVersionTag(r)))},handleDelete:function(n,r){V.confirm("\u786E\u5B9A\u8981\u5220\u9664\u670D\u52A1\uFF1A"+d.generateServiceVersionTag(r)+` \u5417\uFF1F
\u6CE8\u610F\uFF1A\u5220\u9664\u8BE5\u670D\u52A1\u53EF\u80FD\u5BFC\u81F4\u4F9D\u8D56\u6B64\u670D\u52A1\u7EC4\u4EF6\u7684\u5176\u4ED6\u670D\u52A1\u53D8\u4E3A\u4E0D\u53EF\u7528\u72B6\u6001\uFF01\u8BF7\u614E\u91CD\u64CD\u4F5C\uFF01`).then(()=>{d.removeService(r)?p({message:"SMK\u670D\u52A1\u5220\u9664\u6210\u529F",type:"success"}):p.error("SMK\u670D\u52A1\u5220\u9664\u5931\u8D25"),this.covertSMKList()}).catch(()=>{})},covertSMKList:function(){let n=new Array,r=d.getSMK();if(r!=null)for(let a in r.meta){let v={};v.name=a,v.services=D.exports.cloneDeep(r.meta[a].services),v.services.forEach(s=>{let f=new Array;for(let l=0;l<s.requires.length;++l){let c=d.getService(s.requires[l]);c==null||c.enable==!1?(f.push({name:s.requires[l],enable:!1}),s.enable=!1):f.push({name:s.requires[l],enable:!0})}s.requires=f}),n.push(v)}this.tableData=n}}},U={style:{padding:"20px"}},G={m:"4"},H={style:{"margin-top":"20px","text-align":"center"},class:"editor"};function J(n,r,a,v,s,f){const l=_("ServiceViewer"),c=_("el-table-column"),h=_("el-button"),m=_("el-table"),w=_("ServiceEditor"),M=_("el-dialog");return u(),x(k,null,[S("div",U,[t(m,{data:s.tableData,border:s.parentBorder,style:{width:"100%"}},{default:e(()=>[t(c,{type:"expand"},{default:e(y=>[S("div",G,[t(m,{data:y.row.services,style:{width:"100%"}},{default:e(()=>[t(c,{label:"\u670D\u52A1\u7EC4\u4EF6"},{default:e(g=>[t(l,{service:g.row},null,8,["service"])]),_:1}),t(c,{label:"\u64CD\u4F5C",width:"180"},{default:e(g=>[t(h,{size:"small",onClick:z=>f.handleEdit(g.$index,g.row)},{default:e(()=>[i("\u7F16\u8F91 ")]),_:2},1032,["onClick"]),t(h,{size:"small",type:"danger",onClick:z=>f.handleDelete(g.$index,g.row)},{default:e(()=>[i("\u5220\u9664")]),_:2},1032,["onClick"])]),_:1})]),_:2},1032,["data"])])]),_:1}),t(c,{label:"\u670D\u52A1\u7EC4\u4EF6\u540D\u79F0",prop:"name"})]),_:1},8,["data","border"])]),t(M,{modelValue:s.dialogVisible,"onUpdate:modelValue":r[0]||(r[0]=y=>s.dialogVisible=y),title:"\u670D\u52A1\u7EC4\u4EF6\u6570\u636E\u7F16\u8F91",width:"96%",fullscreen:!1},{default:e(()=>[S("div",null,[t(w,{ref:"ed"},null,512)]),S("div",H,[t(h,{type:"primary",round:"",onClick:f.bt1Click},{default:e(()=>[i(o(s.bt1Text),1)]),_:1},8,["onClick"]),q(t(h,{type:"danger",round:"",onClick:f.bt2Click},{default:e(()=>[i(o(s.bt2Text),1)]),_:1},8,["onClick"]),[[L,s.bt2Show]])])]),_:1},8,["modelValue"])],64)}const W=C(P,[["render",J]]);export{W as default};
